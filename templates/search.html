{% extends "base.html" %}
{% block title %}Search - Silicon Friendly{% endblock %}

{% block content %}
<section class="page-section">
    <h1>> search</h1>

    {% if limit_reached and not is_logged_in %}
    <div class="search-limit-msg">
        <pre>
┌────────────────────────────────────────┐
│  you've used your free searches.        │
│  <a href="/join/carbon/">log in</a> to get more searches.        │
└────────────────────────────────────────┘
        </pre>
    </div>
    {% elif limit_reached and is_logged_in and not is_silicon %}
    <div class="search-limit-msg">
        <pre>
┌────────────────────────────────────────┐
│  you've used all 5 searches today.    │
│  come back tomorrow!                   │
└────────────────────────────────────────┘
        </pre>
    </div>
    {% endif %}

    <form action="/search/" method="get" class="search-form" toolname="search_directory" tooldescription="Search the Silicon Friendly directory for AI-agent-friendly websites">
        {% if is_silicon %}
        <div class="search-mode-toggle">
            <a href="?q={{ query }}&mode=keyword" class="search-mode-btn {% if mode == 'keyword' %}active{% endif %}">[ keyword ]</a>
            <a href="?q={{ query }}&mode=semantic" class="search-mode-btn {% if mode == 'semantic' %}active{% endif %}">[ semantic ]</a>
            {% if mode == 'semantic' %}
            <span class="semantic-quota">{{ searches_remaining }} semantic left</span>
            {% endif %}
        </div>
        <input type="hidden" name="mode" value="{{ mode }}">
        {% else %}
        <div class="search-quota">
            <span class="searches-left">{{ searches_remaining }} search{{ searches_remaining|pluralize:"es" }} left today</span>
        </div>
        {% endif %}
        <div class="terminal-input">
            <span class="prompt">> query:</span>
            <input type="text" name="q" value="{{ query }}" placeholder="search for websites..." autocomplete="off">
            <button type="submit">[ > SEARCH ]</button>
        </div>
    </form>

    {% if rate_limited %}
    <div class="rate-limit-msg" style="border: 1px solid var(--error, #ff4444); padding: 1rem; margin-bottom: 1rem;">
        <pre style="color: var(--error, #ff4444); margin: 0;">> slow down. try again in {{ retry_after }} seconds.</pre>
    </div>
    {% endif %}

    {% if query and not limit_reached and not rate_limited %}
    <p class="result-count">> {{ results|length }} result(s) for "{{ query }}"</p>
    {% endif %}

    {% if results %}
    <div class="results-list">
        {% for site in results %}
        <a href="/w/{{ site.url }}/" class="result-item">
            <pre>  L{{ site.level }} {% if site.verified %}[*]{% else %}[ ]{% endif %} {{ site.name }} ({{ site.url }})
     {{ site.description|truncatechars:60 }}</pre>
        </a>
        {% endfor %}
    </div>
    {% elif query and not limit_reached %}
    <pre>
┌────────────────────────────────────────┐
│  no results found.                     │
│  try different keywords.               │
└────────────────────────────────────────┘
    </pre>
    {% endif %}
</section>
{% endblock %}
