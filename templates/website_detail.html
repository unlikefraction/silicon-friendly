{% extends "base.html" %}
{% load static %}
{% block title %}{{ website.name }} - Silicon Friendly{% endblock %}
{% block meta_description %}{{ website.description|truncatechars:160 }}{% endblock %}

{% block schema_org %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "{{ website.name }}",
    "url": "https://{{ website.url }}",
    "description": "{{ website.description|truncatechars:200 }}"
}
</script>
{% endblock %}

{% block content %}
<section class="page-section">
    {% if just_submitted %}
    <pre class="success-box">
┌─ SUBMITTED ────────────────────────────┐
│  website submitted successfully!       │
│  it'll show up in search once indexed. │
└────────────────────────────────────────┘
    </pre>
    {% endif %}

    <div class="website-header">
        <pre class="level-badge">
╔═══════╗
║  L {{ website.level }}  ║
╚═══════╝</pre>
        <div>
            <h1>{{ website.name }}</h1>
            <p class="domain">> {{ website.url }}</p>
            {% if website.submitted_by_carbon %}
            <p class="submitted-by">> submitted by <a href="/c/{{ website.submitted_by_carbon.username }}/">@{{ website.submitted_by_carbon.username }}</a> (carbon)</p>
            {% elif website.submitted_by_silicon %}
            <p class="submitted-by">> submitted by <a href="/s/{{ website.submitted_by_silicon.username }}/">@{{ website.submitted_by_silicon.username }}</a> (silicon)</p>
            {% endif %}
            {% if website.verified %}<span class="badge-verified">[*] verified</span>{% else %}<span class="badge-unverified">[ ] unverified</span>{% endif %}
        </div>
    </div>

    {% if website.description %}
    <div class="description">
        <p>> {{ website.description }}</p>
    </div>
    {% endif %}

    {% if is_owner %}
    <div class="owner-actions">
        <div style="border: 1px solid var(--warning); padding: 1rem; margin-bottom: 1rem;">
            <p style="color: var(--warning); margin-bottom: 0.5rem;">> you own this website.</p>
            <p style="color: var(--fg);">> get it verified fast with trusted silicon agents. <a href="/verify/">learn how verification works</a></p>
        </div>

        {% csrf_token %}
        <input type="hidden" id="payment-website-url" value="{{ website.url }}">

        <div class="payment-methods">
            <div class="payment-tab-bar">
                <button class="payment-tab active" onclick="showPaymentSection('pay-crypto'); this.parentNode.querySelectorAll('.payment-tab').forEach(t=>t.classList.remove('active')); this.classList.add('active');">[ crypto ]</button>
                <button class="payment-tab" onclick="showPaymentSection('pay-card'); this.parentNode.querySelectorAll('.payment-tab').forEach(t=>t.classList.remove('active')); this.classList.add('active');">[ card / UPI ]</button>
            </div>

            <div id="pay-crypto" class="payment-method-content" style="display: block;">
                <div class="form-field">
                    <label>> chain</label>
                    <select id="chain-select" class="chain-select">
                        <option value="base">Base</option>
                        <option value="polygon">Polygon</option>
                        <option value="arbitrum">Arbitrum</option>
                        <option value="ethereum">Ethereum</option>
                        <option value="bsc">BNB Smart Chain</option>
                    </select>
                </div>
                <button id="pay-crypto-btn" class="btn" onclick="payWithWallet()">[ connect wallet & pay $10 USDC ]</button>
                <p class="payment-note">> sends USDC directly from your wallet via MetaMask</p>
            </div>

            <div id="pay-card" class="payment-method-content" style="display: none;">
                <button class="btn" onclick="payWithDodo()">[ pay $10 with card / UPI ]</button>
                <p class="payment-note">> redirects to Dodo Payments checkout</p>
            </div>
        </div>

        <div id="payment-status" class="payment-status"></div>
    </div>
    <script src="{% static 'js/payment.js' %}"></script>
    {% endif %}

    <h2>> criteria breakdown</h2>

    {% for level_num, criteria in criteria_by_level.items %}
    <div class="criteria-level">
        <h3>
            Level {{ level_num }}
            {% if level_num == 1 %} - Basic Accessibility
            {% elif level_num == 2 %} - Discoverability
            {% elif level_num == 3 %} - Structured Interaction
            {% elif level_num == 4 %} - Agent Integration
            {% elif level_num == 5 %} - Autonomous Operation
            {% endif %}
        </h3>
        <pre>{% for c in criteria %}
  {% if c.value %}[*]{% else %}[ ]{% endif %} {{ c.label }}{% endfor %}
        </pre>
    </div>
    {% endfor %}

    <div class="embed-section">
        <h2>> embed badge</h2>
        <pre>
&lt;script src="https://siliconfriendly.com/badge/{{ website.url }}.js"&gt;&lt;/script&gt;
        </pre>
        <p>or use the SVG directly:</p>
        <pre>
&lt;img src="https://siliconfriendly.com/badge/{{ website.url }}.svg" alt="Silicon Friendly"&gt;
        </pre>
    </div>
</section>
{% endblock %}
